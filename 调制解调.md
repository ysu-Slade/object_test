### HART调制解调

#### FSK调制

在二进制频移键控中，幅度恒定不变的载波信号的频率随着输入码流的变化而切换，称作高音（1）和低音（0）。

产生FSK信号的方法是，首先产生FSK基带信号，利用基带信号对单一载波振荡器进行频率调制。

#### HART调制解调结构类型

1、模拟电路内部封装结构

![1608882091419](D:\Git\project\object_test\调制解调.assets\1608882091419.png)

2、模拟电路外部封装结构

![1608882646616](D:\Git\project\object_test\调制解调.assets\1608882646616.png)

#### HART数据流

![1608884430874](D:\Git\project\object_test\调制解调.assets\1608884430874.png)

##### 调制过程

HART通信协议的调制是将0、1数字信号分别调制成频率为2200Hz和1200Hz相位连续的方波信号，再通过模拟电路将两种频率的方波转换成两种频率并且相位连续的正弦波进行传输。

数字信号调制流程

![1608721503096](D:\Git\project\object_test\调制解调.assets\1608721503096.png)



方波转正弦波电路图，该图为低通滤波电路，输入为两种频率的方波信号，而方波信号是基波还有谐波信号组成，通过低通滤波器可将高次谐波滤除，保留基波信号，即可将方波转换成正弦波。模拟电路图（一阶低通滤波）

![1608885398772](D:\Git\project\object_test\调制解调.assets\1608885398772.png)

##### 解调过程

解调可以说调制的逆过程，但是步骤确实相差很大，解调要比调制过程更为复杂。

解调流程

![1608722490412](D:\Git\project\object_test\调制解调.assets\1608722490412.png)

正弦波转方波电路图，该电路由带通滤波器和电压比较器组成，带通滤波器将4-20mA模拟信号滤除，保留1200Hz与2200Hz频率的正弦波数字信号，通过电压比较器（正弦波大于零的部分为1，小于零的部分为0），将两种频率的正弦波转换成两种频率的方波。

![1609118261995](D:\Git\project\object_test\调制解调.assets\1609118261995.png)

#### 设计仿真

针对HART通信协议调制解调部分进行两部分仿真，分别为FPGA调制解调仿真和模拟电路仿真。

##### FPGA仿真

FPGA仿真做了两个模块Modulator调制模块和Demodulator解调模块

![1609119860971](D:\Git\project\object_test\调制解调.assets\1609119860971.png)

###### Modulator调制模块

首先是将50MHz分频，分成两个调制频率2200Hz和1200Hz。

![1609120136235](D:\Git\project\object_test\调制解调.assets\1609120136235.png)

再设置输入数据传输速率，根据HART协议要求，设置成1200bps，数据0、1分别代表两种频率，将分好的两种频率赋给data_M输出

![1609120433618](D:\Git\project\object_test\调制解调.assets\1609120433618.png)

###### Demodulator解调模块

首先将50M时钟进行分频，分成1200Hz，因为HART传输速率为1200bps，所以使接收的数据以1200Hz为周期进行数据更新。

![1609121592405](D:\Git\project\object_test\调制解调.assets\1609121592405.png)

第二部分就是计数器模块，以输入待解调数据作为触发条件，上升沿计数，计算出一个时钟周期（1200Hz）所计算的上升沿个数，来确定输入的数字信号0、1个数

![1609122049050](D:\Git\project\object_test\调制解调.assets\1609122049050.png)

###### 仿真波形

该仿真是将调制的data_M输出作为解调模块的输入进行仿真验证，调制过程是没问题的，成功将0、1数据信息，调制成两种频率相位连续的方波，解调过程设计的为1200Hz周期更新一次，但是更新部分在调制信号触发模块，打拍时间过长，导致更新时间边长（一个时钟周期再加一个打拍），就会出现两次更新，出现错误（有待解决）

![1609122148081](D:\Git\project\object_test\调制解调.assets\1609122148081.png)

##### 模拟电路仿真

对论文电路进行电路仿真

![1608721678007](D:\Git\project\object_test\调制解调.assets\1608721678007.png)

###### 调制过程

将方波转换成正弦波，一阶低通滤波效果很差，高次谐波难以滤除干净，肯定需要高阶滤波电路

![1608722364370](D:\Git\project\object_test\调制解调.assets\1608722364370.png)

###### 解调过程

将正弦波转换成方波。

![1608722044083](D:\Git\project\object_test\调制解调.assets\1608722044083.png)

###### 模拟仿真结论

一阶低通滤波效果很差，高次谐波难以滤除干净，肯定需要高阶滤波电路，电路复杂，电容较多，而解调电路占面积空间大，不单纯是HART通信协议芯片，应用第二种HART芯片结构比较合理，将模拟电路放在芯片外部。

























![1609743186778](D:\Git\project\object_test\调制解调.assets\1609743186778.png)

![1609743206820](D:\Git\project\object_test\调制解调.assets\1609743206820.png)

![1609743271804](D:\Git\project\object_test\调制解调.assets\1609743271804.png)

![1609743338162](D:\Git\project\object_test\调制解调.assets\1609743338162.png)

![1609743415657](D:\Git\project\object_test\调制解调.assets\1609743415657.png)

![1609746358031](D:\Git\project\object_test\调制解调.assets\1609746358031.png)

